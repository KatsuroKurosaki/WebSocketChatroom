"use strict";function chatPreSend(e){var n="which"in e?e.which:e.keyCode;13==n&&chatSend()}function chatSend(){$.trim($("input[name='textchat']").val()).length&&(_ws.send(JSON.stringify({user:$.getData("user-nick"),msg:$.trim($("input[name='textchat']").val())})),$("input[name='textchat']").val(""))}const WS_URL="ws://127.0.0.1:8008/";var _ws;$.isNullData("user-nick")?$.spawnModal({title:"Nick?",body:'<input type="text" name="nick" class="form-control" maxlength="32"/>',buttons:[{label:"Login",color:"success",outline:!0,click:function(){$.trim($("input[name='nick']").val()).length?($.setData("user-nick",$("input[name='nick']").val()),$("#usernick").text($("input[name='nick']").val()+":"),$.removeModal()):$.spawnAlert({body:"No nick written",color:"warning"})}}]}):$("#usernick").text($.getData("user-nick")+":"),_ws=new ReconnectingWebSocket(WS_URL),_ws.onopen=(()=>{console.log("WebSocket open: "+_ws.url),$.removeSpinner()}),_ws.onclose=(()=>{console.log("WebSocket close"),$.spawnSpinner({text:"Connection lost, reconnecting...",icon:"grow",color:"warning",bgcolor:"rgba(0,0,0,0.4)",size:3})}),_ws.onmessage=(e=>{console.log("WebSocket message"),console.log(e.data);var n=JSON.parse(e.data);$("#chatMsgs").append('<div class="media"><img src="img/chat.png" class="mr-3" style="width:30px;"><div class="media-body"><h5 class="mt-0">'+n.user+" <small>("+$.uts2td(n.ts)+")</small></h5>"+n.msg+"</div></div>"),window.scrollTo(0,$("body").height())}),_ws.onerror=(()=>{console.log("WebSocket error"),$.spawnSpinner({text:"Error connecting. Trying again...",icon:"grow",color:"danger",bgcolor:"rgba(0,0,0,0.4)",size:3})});